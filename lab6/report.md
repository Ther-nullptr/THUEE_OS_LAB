# 实验6 管道驱动程序开发

## 1 问题描述

编写一个设备驱动程序mypipe实现管道，该驱动程序创建两个设备实例，一个针对管道的输入端，另一个针对管道的输出端。另外，你还需要编写两个测试程序，一个程序向管道的输入端写入数据，另一个程序从管道的输出端读出数据，从而实现两个进程间通过你自己实现的管道进行数据通信。

## 2 实验平台

本实验在x86_64 平台的Ubuntu 20.04 LTS 操作系统上进行，编程语言采用C++11，构建工具采用GNU Make 4.2.1。

## 3 实验背景

在进行正式的实验之前，我们首先需要了解一些基本的知识，如Linux中的一些机制及其对应的系统函数，这些知识将会在实验中用到。

### 3.1 Linux中的管道实现

在Linux中，管道本质上就是一个文件，前面的进程以写方式打开文件，后面的进程以读方式打开。但是管道本身并不占用磁盘或者其他外部存储的空间，而只占用内存空间。

Linux中的管道分为两种：

1. 匿名管道（Anonymous Pipe）：只能在父子进程或者兄弟进程之间使用，因为管道的两端都是由同一个进程创建的，所以只能在同一个进程中使用。使用`pipe()`函数创建。
2. 命名管道（Named Pipe）：可以在不同的进程之间使用，因为命名管道是由一个进程创建，然后由另一个进程打开的。使用`mkfifo()`函数创建。

#### 3.1.1 匿名管道

Linux中的管道通常被认为是半双工的，即数据只能从管道的一端流向另一端，而不能双向流动，如下图所示：

![image.png](https://s2.loli.net/2023/05/02/eBgXf6RnxoMJHqu.png)

因此在实现时，需要禁用父进程的读和子进程的写。

### 3.2 文件描述符

文件描述符是一个索引值，指向内核为每一个进程所维护的该进程打开文件的记录表。当程序打开一个现有文件或者创建一个新文件时，内核向进程返回一个文件描述符。

默认情况下，每个进程都有三个打开的文件描述符，标准输入（stdin）、标准输出（stdout）和标准错误（stderr），分别对应文件描述符0、1和2，使用以下宏表示：`STDIN_FILENO`, `STDOUT_FILENO`以及`STDERR_FILENO`。这些文件描述符通常被称为标准流。当程序打开或创建一个新文件时，内核会返回一个文件描述符，该文件描述符是当前进程中尚未被使用的最小值。


## 参考文献

https://zhuanlan.zhihu.com/p/442934053

https://zhuanlan.zhihu.com/p/47168082

https://zhuanlan.zhihu.com/p/58489873

https://www.cnblogs.com/Anker/p/3271773.html